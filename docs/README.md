# GoldsrcFramework æ–‡æ¡£

æ¬¢è¿æ¥åˆ° GoldsrcFramework æ–‡æ¡£ä¸­å¿ƒï¼æœ¬ç›®å½•åŒ…å«äº†æ¡†æ¶çš„å®Œæ•´æŠ€æœ¯æ–‡æ¡£ã€‚

## ğŸ“š æ–‡æ¡£ç´¢å¼•

### æ ¸å¿ƒæ–‡æ¡£

#### [Architecture.md](./Architecture.md)
**GoldsrcFramework æ¶æ„æ–‡æ¡£** - æœ€é‡è¦çš„æŠ€æœ¯æ–‡æ¡£

è¯¦ç»†ä»‹ç»äº† GoldsrcFramework çš„æ•´ä½“æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ï¼š
- æ ¸å¿ƒè®¾è®¡ç†å¿µ
- é¡¹ç›®ç»“æ„å’Œå±‚æ¬¡åˆ’åˆ†
- å„ä¸ªç»„ä»¶çš„èŒè´£å’Œäº¤äº’
- åˆå§‹åŒ–æµç¨‹è¯¦è§£
- è¿è¡Œæ—¶è°ƒç”¨æœºåˆ¶
- å®ä½“ç³»ç»Ÿè®¾è®¡
- å…³é”®æŠ€æœ¯ç‚¹è¯´æ˜
- å®Œæ•´çš„å‡½æ•°è°ƒç”¨é“¾

**é€‚åˆ**: æƒ³è¦æ·±å…¥äº†è§£æ¡†æ¶å†…éƒ¨å·¥ä½œåŸç†çš„å¼€å‘è€…

---

#### [Architecture-Diagrams.md](./Architecture-Diagrams.md)
**æ¶æ„å›¾é›†** - å¯è§†åŒ–æ¶æ„æ–‡æ¡£

åŒ…å« 7 ä¸ª Mermaid å›¾è¡¨ï¼Œç›´è§‚å±•ç¤ºï¼š
1. æ•´ä½“æ¶æ„å›¾ - ç»„ä»¶å…³ç³»
2. æœåŠ¡ç«¯åˆå§‹åŒ–æµç¨‹ - æ—¶åºå›¾
3. è¿è¡Œæ—¶å‡½æ•°è°ƒç”¨æµç¨‹ - æ—¶åºå›¾
4. å®ä½“ç§æœ‰æ•°æ®åˆ†é…æµç¨‹ - æ—¶åºå›¾
5. ç±»å‹ç³»ç»Ÿå’Œæ¥å£å±‚æ¬¡ç»“æ„ - ç±»å›¾
6. æ„å»ºå’Œéƒ¨ç½²æµç¨‹ - æµç¨‹å›¾
7. æ•°æ®æµå’Œå†…å­˜ç®¡ç† - æ•°æ®æµå›¾

**é€‚åˆ**: å–œæ¬¢é€šè¿‡å›¾è¡¨ç†è§£ç³»ç»Ÿçš„å¼€å‘è€…

---

#### [Quick-Reference.md](./Quick-Reference.md)
**å¿«é€Ÿå‚è€ƒæ‰‹å†Œ** - å®ç”¨å¼€å‘æŒ‡å—

æä¾›å¿«é€ŸæŸ¥é˜…çš„å‚è€ƒä¿¡æ¯ï¼š
- æ ¸å¿ƒæ¥å£å®šä¹‰ (IServerExportFuncs, IClientExportFuncs)
- å…³é”®ç±»å’Œæ–¹æ³•è¯´æ˜
- å¸¸ç”¨ä»£ç æ¨¡å¼å’Œç¤ºä¾‹
- è°ƒè¯•æŠ€å·§
- å¸¸è§é—®é¢˜è§£ç­”

**é€‚åˆ**: æ­£åœ¨å¼€å‘æ¸¸æˆé€»è¾‘çš„å¼€å‘è€…

---

### é—ç•™æ–‡æ¡£

#### [LegacyBasedArchitecture.md](./LegacyBasedArchitecture.md)
æ—©æœŸçš„æ¶æ„è®¾è®¡æ–‡æ¡£ï¼Œæè¿°äº†åŸºäºåŸç‰ˆ DLL çš„æ¶æ„æ–¹æ¡ˆã€‚

#### [LegacyClientArchitecture.md](./LegacyClientArchitecture.md)
å®¢æˆ·ç«¯æ¶æ„çš„æ—©æœŸè®¾è®¡æ–‡æ¡£ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–°æ‰‹å…¥é—¨è·¯å¾„

1. **äº†è§£é¡¹ç›®** â†’ é˜…è¯» [ä¸» README](../README.md)
2. **ç†è§£æ¶æ„** â†’ é˜…è¯» [Architecture.md](./Architecture.md) çš„"æ¦‚è¿°"å’Œ"æ¶æ„å±‚æ¬¡"éƒ¨åˆ†
3. **æŸ¥çœ‹å›¾è¡¨** â†’ æµè§ˆ [Architecture-Diagrams.md](./Architecture-Diagrams.md) ä¸­çš„æ•´ä½“æ¶æ„å›¾
4. **åŠ¨æ‰‹å®è·µ** â†’ å‚è€ƒ [Quick-Reference.md](./Quick-Reference.md) ä¸­çš„ä»£ç ç¤ºä¾‹
5. **æ·±å…¥å­¦ä¹ ** â†’ å®Œæ•´é˜…è¯» [Architecture.md](./Architecture.md)

### å¼€å‘è€…è·¯å¾„

å¦‚æœä½ æƒ³è¦ï¼š

- **å¼€å‘æ¸¸æˆé€»è¾‘** â†’ ç›´æ¥æŸ¥çœ‹ [Quick-Reference.md](./Quick-Reference.md)
- **ç†è§£æ¡†æ¶åŸç†** â†’ é˜…è¯» [Architecture.md](./Architecture.md)
- **ä¿®æ”¹æ¡†æ¶ä»£ç ** â†’ é˜…è¯» [Architecture.md](./Architecture.md) + [Architecture-Diagrams.md](./Architecture-Diagrams.md)
- **è°ƒè¯•é—®é¢˜** â†’ æŸ¥çœ‹ [Quick-Reference.md](./Quick-Reference.md) çš„"è°ƒè¯•æŠ€å·§"éƒ¨åˆ†

---

## ğŸ“– æ–‡æ¡£ç»“æ„è¯´æ˜

### Architecture.md ç»“æ„

```
Architecture.md
â”œâ”€â”€ æ¦‚è¿°
â”œâ”€â”€ æ ¸å¿ƒè®¾è®¡ç†å¿µ
â”œâ”€â”€ é¡¹ç›®ç»“æ„
â”œâ”€â”€ æ¶æ„å±‚æ¬¡
â”‚   â”œâ”€â”€ åŸç”Ÿå±‚ (Native Layer)
â”‚   â”œâ”€â”€ å¼•æ“æ¥å£å±‚ (Engine Interface Layer)
â”‚   â”œâ”€â”€ æ¡†æ¶å±‚ (Framework Layer)
â”‚   â””â”€â”€ æ¸¸æˆå±‚ (Game Layer)
â”œâ”€â”€ å®ä½“ç³»ç»Ÿ
â”œâ”€â”€ ä»£ç ç”Ÿæˆ
â”œâ”€â”€ æ„å»ºæµç¨‹
â”œâ”€â”€ åˆå§‹åŒ–æµç¨‹
â”‚   â”œâ”€â”€ æœåŠ¡ç«¯åˆå§‹åŒ–
â”‚   â””â”€â”€ å®¢æˆ·ç«¯åˆå§‹åŒ–
â”œâ”€â”€ è¿è¡Œæ—¶è°ƒç”¨æµç¨‹
â”œâ”€â”€ å…³é”®æŠ€æœ¯ç‚¹
â”œâ”€â”€ æ‰©å±•ç‚¹
â”œâ”€â”€ æ€§èƒ½è€ƒè™‘
â”œâ”€â”€ å·²çŸ¥é™åˆ¶
â”œâ”€â”€ æœªæ¥è§„åˆ’
â”œâ”€â”€ å…³é”®å‡½æ•°è°ƒç”¨é“¾ (è¯¦ç»†)
â””â”€â”€ å‚è€ƒèµ„æ–™
```

### Architecture-Diagrams.md ç»“æ„

```
Architecture-Diagrams.md
â”œâ”€â”€ 1. æ•´ä½“æ¶æ„å›¾ (ç»„ä»¶å…³ç³»)
â”œâ”€â”€ 2. æœåŠ¡ç«¯åˆå§‹åŒ–æµç¨‹ (æ—¶åºå›¾)
â”œâ”€â”€ 3. è¿è¡Œæ—¶å‡½æ•°è°ƒç”¨æµç¨‹ (æ—¶åºå›¾)
â”œâ”€â”€ 4. å®ä½“ç§æœ‰æ•°æ®åˆ†é…æµç¨‹ (æ—¶åºå›¾)
â”œâ”€â”€ 5. ç±»å‹ç³»ç»Ÿå’Œæ¥å£å±‚æ¬¡ç»“æ„ (ç±»å›¾)
â”œâ”€â”€ 6. æ„å»ºå’Œéƒ¨ç½²æµç¨‹ (æµç¨‹å›¾)
â””â”€â”€ 7. æ•°æ®æµå’Œå†…å­˜ç®¡ç† (æ•°æ®æµå›¾)
```

### Quick-Reference.md ç»“æ„

```
Quick-Reference.md
â”œâ”€â”€ æ ¸å¿ƒæ¥å£
â”‚   â”œâ”€â”€ IServerExportFuncs
â”‚   â””â”€â”€ IClientExportFuncs
â”œâ”€â”€ å…³é”®ç±»å’Œæ–¹æ³•
â”‚   â”œâ”€â”€ FrameworkInterop
â”‚   â”œâ”€â”€ ServerMain / ClientMain
â”‚   â””â”€â”€ LegacyServerInterop / LegacyClientInterop
â”œâ”€â”€ å¸¸ç”¨ä»£ç æ¨¡å¼
â”‚   â”œâ”€â”€ åˆ›å»ºè‡ªå®šä¹‰æœåŠ¡ç«¯å®ç°
â”‚   â”œâ”€â”€ è°ƒç”¨å¼•æ“å‡½æ•°
â”‚   â”œâ”€â”€ è®¿é—®å…¨å±€å˜é‡
â”‚   â”œâ”€â”€ æ“ä½œå®ä½“
â”‚   â””â”€â”€ åˆ›å»ºè‡ªå®šä¹‰å®¢æˆ·ç«¯å®ç°
â”œâ”€â”€ è°ƒè¯•æŠ€å·§
â”‚   â”œâ”€â”€ å¯ç”¨æ§åˆ¶å°è¾“å‡º
â”‚   â”œâ”€â”€ é™„åŠ è°ƒè¯•å™¨
â”‚   â”œâ”€â”€ æ¡ä»¶æ–­ç‚¹
â”‚   â””â”€â”€ æ—¥å¿—è®°å½•
â””â”€â”€ å¸¸è§é—®é¢˜
```

---

## ğŸ” å…³é”®æ¦‚å¿µé€ŸæŸ¥

### å››å±‚æ¶æ„

1. **åŸç”Ÿå±‚** (C++) - GoldsrcFramework.Loader
   - åŠ è½½ .NET è¿è¡Œæ—¶
   - å¯¼å‡ºå¼•æ“æœŸæœ›çš„å‡½æ•°
   
2. **å¼•æ“æ¥å£å±‚** (C#) - GoldsrcFramework.Engine
   - ç±»å‹å®šä¹‰ (edict_t, entvars_t, Vector3f ç­‰)
   - æ¥å£å®šä¹‰ (IServerExportFuncs, IClientExportFuncs)
   
3. **æ¡†æ¶å±‚** (C#) - GoldsrcFramework
   - FrameworkInterop: ç»Ÿä¸€å…¥å£ç‚¹
   - ServerMain/ClientMain: ç®¡ç†ç±»
   - LegacyInterop: åŸç‰ˆ DLL æ¡¥æ¥
   - FrameworkExports: é»˜è®¤å®ç°
   
4. **æ¸¸æˆå±‚** (C#) - GoldsrcFramework.Demo æˆ–è‡ªå®šä¹‰
   - å®ç° IServerExportFuncs/IClientExportFuncs
   - è‡ªå®šä¹‰æ¸¸æˆé€»è¾‘

### å…³é”®æµç¨‹

- **åˆå§‹åŒ–**: Engine â†’ Loader â†’ .NET Runtime â†’ FrameworkInterop â†’ ServerMain/ClientMain â†’ Game Assembly
- **è¿è¡Œæ—¶è°ƒç”¨**: Engine â†’ Function Table â†’ Game Exports â†’ [Optional: Legacy DLL]
- **å¼•æ“è°ƒç”¨**: Game Code â†’ enginefuncs_t â†’ Engine
- **å®ä½“åˆ†é…**: Engine â†’ Entity Export â†’ GetPrivateDataAllocator â†’ Legacy DLL

### æ ¸å¿ƒæŠ€æœ¯

- **UnmanagedCallersOnly**: å…è®¸åŸç”Ÿä»£ç ç›´æ¥è°ƒç”¨æ‰˜ç®¡å‡½æ•°
- **å‡½æ•°æŒ‡é’ˆ**: `delegate* unmanaged[Cdecl]<...>` è¡¨ç¤ºåŸç”Ÿå‡½æ•°æŒ‡é’ˆ
- **åŠ¨æ€åŠ è½½**: è¿è¡Œæ—¶åŠ è½½æ¸¸æˆç¨‹åºé›†
- **åŒå‘äº’æ“ä½œ**: æ¡†æ¶ â†” å¼•æ“, æ¡†æ¶ â†” åŸç‰ˆ DLL

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### é˜…è¯»é¡ºåºå»ºè®®

**å¿«é€Ÿäº†è§£** (30 åˆ†é’Ÿ):
1. ä¸» README.md
2. Architecture.md çš„"æ¦‚è¿°"å’Œ"æ¶æ„å±‚æ¬¡"
3. Architecture-Diagrams.md çš„æ•´ä½“æ¶æ„å›¾

**æ·±å…¥ç†è§£** (2-3 å°æ—¶):
1. Architecture.md å®Œæ•´é˜…è¯»
2. Architecture-Diagrams.md æ‰€æœ‰å›¾è¡¨
3. Quick-Reference.md çš„ä»£ç ç¤ºä¾‹

**å®æˆ˜å¼€å‘** (è¾¹åšè¾¹å­¦):
1. Quick-Reference.md ä½œä¸ºæ‰‹å†Œ
2. å‚è€ƒ Example.cs ç¤ºä¾‹ä»£ç 
3. é‡åˆ°é—®é¢˜æŸ¥é˜… Architecture.md

### æ–‡æ¡£ç»´æŠ¤

è¿™äº›æ–‡æ¡£åº”è¯¥éšç€ä»£ç çš„æ¼”è¿›è€Œæ›´æ–°ã€‚å¦‚æœä½ å‘ç°ï¼š
- æ–‡æ¡£ä¸ä»£ç ä¸ä¸€è‡´
- ç¼ºå°‘é‡è¦ä¿¡æ¯
- æœ‰é”™è¯¯æˆ–ä¸æ¸…æ¥šçš„åœ°æ–¹

è¯·æäº¤ Issue æˆ– Pull Requestï¼

---

## ğŸ”— ç›¸å…³èµ„æº

### é¡¹ç›®å†…èµ„æº

- [ä¸» README](../README.md) - é¡¹ç›®ä»‹ç»å’Œä½¿ç”¨è¯´æ˜
- [Guide.md](../src/Guide.md) - é¡¹ç›®ç»“æ„è§„åˆ’
- [Example.cs](../src/GoldsrcFramework/Example.cs) - å®Œæ•´ç¤ºä¾‹ä»£ç 
- [Engine README](../src/GoldsrcFramework.Engine/README.md) - å¼•æ“æ¥å£å±‚è¯´æ˜

### å¤–éƒ¨èµ„æº

- [HLSDK](https://github.com/ValveSoftware/halflife) - Half-Life SDK
- [.NET Hosting](https://docs.microsoft.com/en-us/dotnet/core/tutorials/netcore-hosting) - .NET æ‰˜ç®¡æ–‡æ¡£
- [UnmanagedCallersOnly](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.unmanagedcallersonlyattribute) - äº’æ“ä½œç‰¹æ€§
- [Function Pointers](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-9.0/function-pointers) - C# å‡½æ•°æŒ‡é’ˆ

---

## ğŸ“ æ–‡æ¡£ç‰ˆæœ¬

- **åˆ›å»ºæ—¥æœŸ**: 2025-09-30
- **æ¡†æ¶ç‰ˆæœ¬**: WIP (Work In Progress)
- **æ–‡æ¡£çŠ¶æ€**: åˆå§‹ç‰ˆæœ¬

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿å¯¹æ–‡æ¡£è¿›è¡Œæ”¹è¿›ï¼å¦‚æœä½ æƒ³è´¡çŒ®ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºæ–‡æ¡£åˆ†æ”¯
3. ä¿®æ”¹æˆ–æ·»åŠ æ–‡æ¡£
4. æäº¤ Pull Request

æ–‡æ¡£è´¡çŒ®åŒæ ·é‡è¦ï¼

---

**Happy Coding with GoldsrcFramework! ğŸ®**

